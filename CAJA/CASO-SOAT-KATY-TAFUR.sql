USE SIGSALUD
SELECT * FROM ITEM WHERE NOMBRE LIKE '%INTERCONSULTA%'


SELECT * FROM PRECIO WHERE ITEM = '53329'

SELECT * FROM PRECIO WHERE ITEM = '607088'
SELECT * FROM PRECIO WHERE ITEM = '606979'

SELECT * FROM ITEM WHERE CODCPT = '99241' ORDER BY ITEM DESC

SELECT * FROM PRECIO WHERE ITEM = '63388'
SELECT * FROM PRECIO WHERE ITEM = '606979'




SELECT * FROM CUENTA WHERE CUENTAID = '1709031'
SELECT * FROM CUENTADET WHERE CUENTAID = '1709031'



SELECT * FROM ITEM WHERE ITEM = '607088'
SELECT * FROM PRECIO WHERE ITEM = '607088'

SELECT * FROM ITEM WHERE ITEM = '606979'
SELECT * FROM PRECIO WHERE ITEM = '606979'


SELECT * FROM CUENTA WHERE CUENTAID = '1709031'
SELECT * FROM CUENTADET WHERE CUENTAID = '1709031'


/*********** INICIO DEL PROCESO *****/


/* INTERCONSULAS */
UPDATE CUENTADET SET PRECIO = 38 WHERE CUENTAID = '1709031' AND ITEM = '607088'
UPDATE CUENTADET SET IMPORTE = PRECIO * CANTIDAD WHERE CUENTAID = '1709031' AND ITEM = '607088'
UPDATE CUENTADET SET TOTAL = IMPORTE  WHERE CUENTAID = '1709031' AND ITEM = '607088'
UPDATE CUENTADET SET PRECIO = 33 WHERE CUENTAID = '1709031' AND ITEM = '606979'
UPDATE CUENTADET SET IMPORTE = PRECIO * CANTIDAD WHERE CUENTAID = '1709031' AND ITEM = '606979'
UPDATE CUENTADET SET TOTAL = IMPORTE  WHERE CUENTAID = '1709031' AND ITEM = '606979'
  
/* RAYOS */

UPDATE CUENTADET SET PRECIO = 25 WHERE CUENTAID = '1709031' AND ITEM = '605782'
UPDATE CUENTADET SET IMPORTE = PRECIO * CANTIDAD WHERE CUENTAID = '1709031' AND ITEM = '605782'
UPDATE CUENTADET SET TOTAL = IMPORTE  WHERE CUENTAID = '1709031' AND ITEM = '605782'


UPDATE CUENTADET SET PRECIO = 23 WHERE CUENTAID = '1709031' AND ITEM = '605868'
UPDATE CUENTADET SET IMPORTE = PRECIO * CANTIDAD WHERE CUENTAID = '1709031' AND ITEM = '605868'
UPDATE CUENTADET SET TOTAL = IMPORTE  WHERE CUENTAID = '1709031' AND ITEM = '605868'

   
/* INYECCION */
  
UPDATE CUENTADET SET PRECIO = 7 WHERE CUENTAID = '1709031' AND ITEM = '606605'
UPDATE CUENTADET SET IMPORTE = PRECIO * CANTIDAD WHERE CUENTAID = '1709031' AND ITEM = '606605'
UPDATE CUENTADET SET TOTAL = IMPORTE  WHERE CUENTAID = '1709031' AND ITEM = '606605'


/* TOTAL */

UPDATE CUENTA SET CARGO = (SELECT SUM(TOTAL) FROM CUENTADET  WHERE CUENTAID = '1709031'), IMPORTE = (SELECT SUM(TOTAL) AS  TOTAL FROM CUENTADET  WHERE CUENTAID = '1709031')
  WHERE  CUENTAID = '1709031'


/****  FIN *****/
  

SELECT * FROM ITEM WHERE ITEM = '606605'
SELECT * FROM PRECIO WHERE ITEM = '606605'


/***/


SELECT * FROM CUENTA WHERE SEGURO = '02' AND ESTADO = '2' AND FECHA_APERTURA BETWEEN CONVERT(DATETIME, '2016-06-20', 101) AND CONVERT(DATETIME, '2017-03-07', 101)
  ORDER BY FECHA_APERTURA DESC
  
SELECT * FROM CUENTADET WHERE CUENTAID = '1700817'
  
SELECT * FROM CUENTADET WHERE CUENTAID = '1714606'


SELECT * FROM ITEM WHERE ITEM = '605846'

SELECT * FROM PRECIO  WHERE ITEM = '605846'


DECLARE @LCITEM VARCHAR(13) = '50592'
SELECT CODCPT, * FROM ITEM WHERE ITEM = @LCITEM
SELECT * FROM PRECIO WHERE ITEM IN (@LCITEM)



SELECT * FROM CUENTADET WHERE CUENTAID = '1700817'


SELECT * FROM CUENTA WHERE SEGURO = '02' AND ESTADO IN ('1','2') AND FECHA_APERTURA >= CONVERT(DATETIME, '2016-06-20', 101)   ORDER BY FECHA_APERTURA DESC

SELECT * FROM V_CUENTADET WHERE CUENTAID =  '1728238'




SELECT *  FROM V_PRECIO_CREDITO WHERE UNIDOS 


SELECT *  FROM V_PRECIO_CREDITO ORDER BY ITEM ASC

SELECT *  FROM V_PRECIO_CREDITO WHERE NOMBRE LIKE 'CONSULTA%'



select * from ITEM where NOMBRE like '%curacion%' and substring(item,1,1) = '5' order by ITEM desc



select * from PRECIO where ITEM in (select item from ITEM where NOMBRE like '%curacion%' and substring(item,1,1) = '5')

/******************/

declare @lccuentaid varchar(13) = '1715414'

select CUENTAID, CARGO, DESCUENTO, ABONO, importe, CARGO-DESCUENTO+ABONO as impor from CUENTA where CUENTAID = '1715414'

select CUENTAID, ITEM, PRECIO, CANTIDAD, IMPORTE, DESCUENTO, TOTAL from CUENTADET where CUENTAID = '1715414'

select CUENTAID, ITEM, PRECIO, CANTIDAD, IMPORTE, DESCUENTO, TOTAL, PRECIO*CANTIDAD as impor, IMPORTE-DESCUENTO as tot  from CUENTADET where CUENTAID = '1715414'


SELECT SUM(TOTAL) FROM CUENTADET  WHERE CUENTAID = '1715414'


/* CALCULOS */
declare @lccuentaid varchar(13) = '1715414'
update CUENTADET set IMPORTE = PRECIO*CANTIDAD, TOTAL = IMPORTE-DESCUENTO WHERE CUENTAID = @lccuentaid

declare @lccuentaid varchar(13) = '1715414'
UPDATE CUENTA SET CARGO = (SELECT SUM(TOTAL) FROM CUENTADET  WHERE CUENTAID = @lccuentaid) WHERE CUENTAID = @lccuentaid

declare @lccuentaid varchar(13) = '1715414'
update CUENTA set IMPORTE = CARGO-DESCUENTO+ABONO where CUENTAID = @lccuentaid


